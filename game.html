<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>游戏页</title>
	<link href="css/hero.css" type="text/css" rel="stylesheet">
	<link rel="stylesheet" href="./webfonts/iconfont.css">
	<link href="css/text.css" type="text/css" rel="stylesheet">
	<link href="css/reasoning.css" type="text/css" rel="stylesheet">
	<link href="css/manual.css" type="text/css" rel="stylesheet">
	<link href="music-player/music-player.css" type="text/css" rel="stylesheet">

	<script language="javascript" src="js/jquery-1.8.3.min.js"></script>
	<script src="./archive/script.js"></script>
	<script src="./js/archive.js"></script>
	<style>
		*{
			margin:0;
		}
		::-webkit-scrollbar {
  			display: none;
		}
		/* 主要游戏窗口的设置 */
		.window{
			width:1000px;
			height:800px;
			position:absolute;
			background-color:black;
			top:50%;
			left:50%;
			transform:translate(-50%,-50%);
			/* border:30px solid;
			border-image: url(./img/edge.png) 27; */
			background-repeat:no-repeat;
			background-size: 1000px 800px;
			overflow:hidden;
		}
		.panel {
			width: 80%;
			max-width: 600px;
			margin: 20px auto;
			background-color: #fff;
			border-radius: 8px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			padding: 20px;
		}
		.content {
			margin-bottom: 20px;
		}
		.switch {
			font-size: 1.2em;
			color: #333;
		}
		.container {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 20px;
			padding: 20px;
		}
		.save-slot {
			background-color: #f9f9f9;
			border: 1px solid #ddd;
			border-radius: 8px;
			padding: 15px;
			text-align: center;
		}
		.save-slot h2 {
			margin-top: 0;
			color: #333;
		}
		.save-slot p {
			color: #666;
			margin: 5px 0;
		}
		.save-slot button {
			background-color: #007bff;
			color: #fff;
			border: none;
			padding: 8px 15px;
			border-radius: 5px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}
		.save-slot button:hover {
			background-color: #0056b3;
		}

	</style>
	
	<!-- 游戏进度保存 -->
	<script>
		setTimeout(function(){
			$('.manual').fadeOut(500);
		},4000);
		var usr=localStorage.getItem('Hound_'+"CurrentPlayer");
		var archive_pointer=Number(localStorage.getItem('Hound_'+usr+'_archive_pointer'));
		function save_hint(text){
			if(text=='当前存档已满，已覆盖最早的现有存档！') $('.hint').css('width','300px');
			$('.hint').fadeIn(500);
			$('.hint').html(text);
			setTimeout(function(){
				$(".hint").fadeOut(2000);
				setTimeout(function(){
					if(text=='当前存档已满，已覆盖最早的现有存档！') $('.hint').css('width','200px');
				},2000);
			},1500);
		}
		function click_save(){
			if(archive_pointer>8){
				save_hint('当前存档已满，已覆盖最早的现有存档！');
				save('archive'+archive_pointer%9,archive_pointer%9+1);
			}
			else{
				save('archive'+archive_pointer,archive_pointer+1);
				save_hint('存档成功！');
			}
			archive_pointer++;
			localStorage.setItem('Hound_'+usr+'_archive_pointer',archive_pointer);
		}
	</script>
</head>
<!-- 游戏背景图片设置，有点丑陋目前 -->
<body style="background-image: url('./img/usbackground.jpg'); background-size: cover; background-position: center; background-repeat: repeat;">

	<div class="window">
		<div class="music-container" id="music-container">
			<audio src="./music-player/music/summer pocket.mp3" id="audio"></audio>
			<div class="navigation">
				<button id="prev" class="action-btn">
					<i class="iconfont icon-backward_fill"></i>
				</button>
				<button id="play" class="action-btn action-btn-big">
					<i class="iconfont icon-play_fill"></i>
				</button>
				<button id="next" class="action-btn">
					<i class="iconfont icon-play_forward_fill"></i>
				</button>
				<a id="currentMusic">CurrentMusic</a>
			</div>
		</div>
		<!-- <div class="auto-play-music"></div> -->
		<div id="hud"></div>
		<!-- 提供“继续游戏”、“保存游戏”和“退出游戏”三个选项。
		“继续游戏”按钮隐藏当前菜单。
		“保存游戏”按钮调用 click_save() 函数。
		“退出游戏”按钮重定向到主菜单页面。 -->
		<div class="option">
			<p>PAUSE</p>
			<ul type="none">
				<li><button onclick="option_now=0;$('.option').css('display','none')">继续游戏</button></li>
				<li><button onclick="click_save()">保存游戏</button></li>
				<li><button onclick="$('.option').css('display','none');$('.loadpage').css('display','block');showtime()">读取存档</button></li>
				<li><button onclick="window.parent.postMessage('showMusicPlayer', '*');window.location.href = './home/home.html';">退出游戏</button></li>
			</ul>
		</div>
		<div class="achievement">
			<!-- 显示获得的成就，当前示例文本为“哈哈哈哈哈”。 -->
			<p>获得成就</p>
			<div id="achieve">哈哈哈哈哈</div>
		</div>
		<!-- 嵌入了小游戏的iframe。
		提供“退出”按钮，点击后隐藏小游戏界面并重置相关样式。 -->
		<div class="game1" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">

			<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: -1; pointer-events: none;"></div>
			<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
				<iframe src="./minigame/game1/game.html" style="width:100%; height:90%; border: 0cm;"></iframe>
				<button onclick="$('.game1').css('display','none'),obj='none',$('.container').css('margin-top','0'),$('.container').css('margin-left','0')" style="font-size: 2em; padding: 10px 20px;">退出</button>
			</div>
		</div>

		<div class="game2" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">

			<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: -1; pointer-events: none;"></div>
			<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
				<iframe src="./minigame/game2/game.html" style="width:100%; height:90%; border: 0cm;"></iframe>
				<button onclick="$('.game2').css('display','none'),obj='none',$('.container').css('margin-top','0'),$('.container').css('margin-left','0')" style="font-size: 2em; padding: 10px 20px;">退出</button>
			</div>
		</div>
		
		<div class="game3" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">

			<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: -1; pointer-events: none;"></div>
			<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
				<iframe src="./minigame/game3/game.html" style="width:100%; height:90%; border: 0cm;"></iframe>
				<button onclick="$('.game3').css('display','none'),obj='none',$('.container').css('margin-top','0'),$('.container').css('margin-left','0')" style="font-size: 2em; padding: 10px 20px;">退出</button>
			</div>
		</div>

		<div class="loadpage" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">
			<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0); z-index: -1; pointer-events: none;"></div>
			<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">

				<div class="container">
					<div class="save-slot">
						<h2>存档 1</h2>
						<p id="time1">Empty</p>
						<p id="scene1" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time1').text()!='Empty'){reload('archive0'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));}; $('.loadpage').css('display','none'); $('.text').css('display','none')">Load</button>
					</div>
					<div class="save-slot">
						<h2>存档 2</h2>
						<p id="time2">Empty</p>
						<p id="scene2" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time2').text()!='Empty'){reload('archive1'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));}; $('.loadpage').css('display','none'); $('.text').css('display','none')">Load</button>
					</div>
					<div class="save-slot">
						<h2>存档 3</h2>
						<p id="time3">Empty</p>
						<p id="scene3" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time3').text()!='Empty'){reload('archive2'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));}; $('.loadpage').css('display','none'); $('.text').css('display','none')">Load</button>
					</div>
					<div class="save-slot">
						<h2>存档 4</h2>
						<p id="time4">Empty</p>
						<p id="scene4" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time4').text()!='Empty'){reload('archive3'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));}; $('.loadpage').css('display','none'); $('.text').css('display','none')">Load</button>
					</div>
					<div class="save-slot">
						<h2>存档 5</h2>
						<p id="time5">Empty</p>
						<p id="scene5" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time5').text()!='Empty'){reload('archive4'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));}; $('.loadpage').css('display','none'); $('.text').css('display','none')">Load</button>
					</div>
					<div class="save-slot">
						<h2>存档 6</h2>
						<p id="time6">Empty</p>
						<p id="scene6" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time6').text()!='Empty'){reload('archive5'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));}; $('.loadpage').css('display','none'); $('.text').css('display','none')">Load</button>
					</div>
					<div class="save-slot">
						<h2>存档 7</h2>
						<p id="time7">Empty</p>
						<p id="scene7" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time7').text()!='Empty'){reload('archive6'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));}; $('.loadpage').css('display','none'); $('.text').css('display','none')">Load</button>
					</div>
					<div class="save-slot">
						<h2>存档 8</h2>
						<p id="time8">Empty</p>
						<p id="scene8" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time8').text()!='Empty'){reload('archive7'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));}; $('.loadpage').css('display','none'); $('.text').css('display','none')">Load</button>
					</div>
					<div class="save-slot">
						<h2>存档 9</h2>
						<p id="time9">Empty</p>
						<p id="scene9" style="font-size: large;">&nbsp;</p>
						<button onclick="if($('#time9').text()!='Empty'){reload('archive8'); $('.game1 iframe').attr('src', $('.game1 iframe').attr('src')); $('.game2 iframe').attr('src', $('.game2 iframe').attr('src')); $('.game3 iframe').attr('src', $('.game3 iframe').attr('src'));} else {alert('该存档为空')}; $('.loadpage').css('display','none')">Load</button>
					</div>
				</div>
				<button onclick="$('.loadpage').css('display','none'),obj='none',$('.container').css('margin-top','0'),$('.container').css('margin-left','0'), window.resetMovement(), front=0, back=0, left=0, right=0, option_now = 0" style="font-size: 2em; padding: 10px 20px;">返回</button>
			</div>
		</div>

		<!-- 显示游戏操作指南，包括人物移动、物品交互、NPC对话等操作说明。 -->
		<div class="manual">
			<div style="margin-top:150px">
				<p>W,A,S,D:人物移动</p>
				<p>E:与NPC对话/进入下一个场景</p>
			</div>
		</div>
		<button id="skipCgButton" style="position: absolute; top: 10px; right: 10px; z-index: 1000000; background-color: rgba(0,0,0,0.5); color: white; padding: 10px 20px; cursor: pointer; display: none;">跳过CG</button>
		<!-- 显示游戏角色，设置了初始位置 -->
		<div class="hero" style="left:200px;top:200px;"></div>
		<!-- 显示游戏中的NPC角色。 -->
		<div class="npc" id="npc1"></div>
		<div class="npc" id="npc2"></div>
		<div class="npc" id="npc3"></div>
		<!-- 包含图片和文本容器，用于显示游戏中的对话和提示。 -->
		<div class="text">
			<div class="picture"></div>
			<div class="container">
				<div class="title"></div>
				<div class="texture"></div>
			</div>
			<div class="dialog_button"></div>
		</div>
		
		<!-- 提供两个个按钮，用于玩家进行对话选择。 -->
		<div class="choice_zone">
			<button id="choice1" onclick="choice(0)" style="margin-top:70px"></button><br>
			<button id="choice2" onclick="choice(1)" style="margin-top:30px"></button><br>
		</div>
		
		<!-- 用于显示游戏中的其他信息。 -->
		<div class="display"></div>
		<!-- 用于显示游戏中的提示信息。 -->
		<div class="hint"></div>

		<!-- 幕布 (<div class="curtain">)用于显示游戏中的背景和字幕。 -->
		<div class="curtain">
			<div class="background_board"></div>
			<div class="caption"></div>
		</div>
		<!-- <div class="video">
			<video id="bgVideo" src="video/test2.mp4"></video>
			<button id="skipVideoButton" style="position: absolute; top: 10px; right: 10px; z-index: 1000000; background-color: rgba(0,0,0,0.5); color: white; padding: 10px 20px; cursor: pointer; display: none;">跳过CG</button>
		</div> -->
		
	</div>

	<!-- <script>
		function showVideo() {
			document.querySelector('#bgVideo').style.display = 'block';
			document.querySelector('#skipVideoButton').style.display = 'block';
			document.getElementById('bgVideo').play();
		}

		function hideVideo() {
			document.querySelector('.video').style.display = 'none';
			document.querySelector('#skipVideoButton').style.display = 'none';
			document.getElementById('bgVideo').pause();
			document.getElementById('bgVideo').currentTime = 0;
		}
		document.getElementById('skipVideoButton').addEventListener('click', hideVideo);

		document.getElementById('bgVideo').addEventListener('ended', hideVideo);
	</script> -->

	<script language="javascript" src="js/game_music.js"></script> 
	<script language="javascript" src="js/archive.js"></script>
	<script language="javascript" src="js/patch.js"></script>
	<script language="javascript" src="js/init.js"></script>
	<script language="javascript" src="js/clue.js"></script>
	<script language="javascript" src="js/npc.js"></script>	
	<script language="javascript" src="js/hurdle.js"></script>
	<script language="javascript" src="js/map.js"></script>
	<script language="javascript" src="js/interact.js"></script>
	<script language="javascript" src="js/end.js"></script>
	<script language="javascript" src="js/hud.js"></script>
	<script language="javascript" src="js/startgame.js"></script>
	<script language="javascript" src="js/object.js"></script>


	<style>
		#myImage {
			position: fixed; /* 固定位置 */
			top: 50%; /* 垂直居中 */
			left: 50%; /* 水平居中 */
			transform: translate(-50%, -50%); /* 调整偏移量以实现真正的居中 */
			z-index: 1000; /* 置于最顶层 */
			display: none; /* 保持隐藏状态，除非通过JavaScript显示 */
		}
	</style>
	<img id="myImage" src="" style="display: none;" />

    <script>
    // 添加点击事件监听器，点击游戏页面时重新获取焦点
    document.addEventListener('click', function() {
        // 确保游戏窗口获得焦点
        window.focus();
    });
    
    // 添加鼠标进入事件监听器
    document.addEventListener('mouseenter', function() {
        // 确保游戏窗口获得焦点
        window.focus();
    });
    </script>
	
	<script>
		window.addEventListener('message', function(event) {
			// 检查消息的来源，确保是来自预期的子 iframe
			// 在文件系统环境下，源通常是 'null'
			// if (event.origin !== 'null' && event.origin !== 'file://') {
			//     return; // 忽略来自未知源的消息
			// }

			if (event.data === 'win_game1') {
				old_knight = 7;
			} else if (event.data === 'lose_game1') {
				old_knight = 8;
			} else if (event.data === 'win_game3') {
				newspaper_boy = 1;
			} else if (event.data === 'lose_game3') {
				newspaper_boy = 4;
			}
		});
	</script>
	<!-- 游戏内的音乐播放器，与主页不同 -->

	</body>

</html>